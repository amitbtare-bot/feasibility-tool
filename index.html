<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chemical Feasibility Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#1f2a44;}
body{
  margin:0;
  font-family:Segoe UI;
  background:var(--bg);
  transition:background 1s ease;
}

header{
  text-align:center;
  padding:20px;
  color:#fff;
}

#visualLayer{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index:0;
}

#visualLayer img{
  width:280px;
  opacity:0.12;
  animation:spin 40s linear infinite;
}

@keyframes spin{
  from{transform:rotate(0deg);}
  to{transform:rotate(360deg);}
}

main{
  max-width:1200px;
  margin:auto;
  background:#f4f6f8;
  color:#222;
  padding:30px;
  border-radius:14px;
  position:relative;
  z-index:1;
}

label{font-weight:600;margin-top:10px;display:block}
input,button{width:100%;padding:8px;margin-top:6px}

button{
  background:#263238;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:disabled{opacity:.5}

#chemResults{
  background:#fff;
  border:1px solid #ccc;
  display:none;
}
#chemResults div{
  padding:6px;
  cursor:pointer;
}
#chemResults div:hover{background:#eee}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  margin-top:20px;
}

.card{
  background:#263238;
  color:#fff;
  padding:15px;
  border-radius:10px;
  text-align:center;
}

.verdict{
  padding:15px;
  border-radius:10px;
  font-size:18px;
  margin-top:20px;
}
.good{background:#2e7d32}
.warn{background:#ef6c00}
.bad{background:#c62828}
</style>
</head>

<body>

<!-- VISUAL BACKGROUND -->
<div id="visualLayer">
  <img id="moleculeImg" src="" alt="">
</div>

<header>
<h1>Chemical Feasibility Tool</h1>
<p>Scale-first • Engineering-driven</p>
</header>

<main>

<label>Search Chemical</label>
<input id="chemSearch" placeholder="ethyl, acetone…" oninput="filterChemicals()">
<div id="chemResults"></div>

<label>Capacity (TPA)</label>
<input id="scale" type="number" placeholder="Enter capacity" oninput="checkReady()">

<button id="evalBtn" onclick="evaluate()" disabled>
Evaluate Feasibility
</button>

<div class="grid" id="resultGrid" style="display:none">
  <div class="card"><h3>CAPEX</h3><div id="capex"></div></div>
  <div class="card"><h3>OPEX</h3><div id="opex"></div></div>
  <div class="card"><h3>EBITDA</h3><div id="ebitda"></div></div>
  <div class="card"><h3>Ideal Scale</h3><div id="ideal"></div></div>
</div>

<div id="verdictBox" class="verdict">
Select chemical & capacity
</div>

</main>

<script>
/* ================= GLOBAL STATE ================= */
let CHEM_DB = [];
let DB_READY = false;
let SELECTED_CHEM = null;

/* ================= THEMES ================= */
const THEMES = {
  Esterification:"#1f2a44",
  Hydrogenation:"#1b5e20",
  Oxidation:"#263238",
  Resin_Polymerization:"#4a148c",
  default:"#1f2a44"
};

/* ================= LOAD CSV ================= */
fetch("chemicals.csv")
.then(r=>r.text())
.then(t=>{
  const rows = t.trim().split("\n");
  const h = rows[0].split(",");
  CHEM_DB = rows.slice(1).map(r=>{
    const v = r.split(",");
    let o = {};
    h.forEach((k,i)=>o[k.trim()] = (v[i]||"").trim());
    return o;
  });
  DB_READY = true;
});

/* ================= SEARCH ================= */
function filterChemicals(){
  const q = chemSearch.value.toLowerCase();
  chemResults.innerHTML="";
  if(q.length<2){chemResults.style.display="none";return;}

  CHEM_DB
    .filter(c=>c.chemical_name.toLowerCase().includes(q))
    .forEach(c=>{
      const d=document.createElement("div");
      d.innerText=c.chemical_name;
      d.onclick=()=>selectChemical(c);
      chemResults.appendChild(d);
    });

  chemResults.style.display="block";
}

function selectChemical(c){
  SELECTED_CHEM = c;
  chemSearch.value = c.chemical_name;
  chemResults.style.display="none";

  document.body.style.background =
    THEMES[c.process_family] || THEMES.default;

  moleculeImg.src = "assets/molecule.png";
  moleculeImg.style.display = "block";

  checkReady();
}

/* ================= READINESS ================= */
function checkReady(){
  evalBtn.disabled = !(DB_READY && SELECTED_CHEM && scale.value);
}

/* ================= EVALUATE ================= */
function evaluate(){
  if(!SELECTED_CHEM) return;

  const c = SELECTED_CHEM;
  const S = +scale.value;

  resultGrid.style.display="grid";

  const opex = +c.base_opex_rs_per_t;
  const ebitda = ((c.selling_price_rs_per_t - opex) / c.selling_price_rs_per_t * 100).toFixed(1);

  capex.innerText = `₹ ${c.base_capex_cr} Cr`;
  opexEl.innerText = `₹ ${opex}`;
  ebitdaEl.innerText = `${ebitda} %`;
  ideal.innerText = `${c.ideal_scale_min_tpa} – ${c.ideal_scale_max_tpa} TPA`;

  let cls="bad",txt="Not Recommended";
  if(ebitda>15){cls="good";txt="Commercially Viable";}
  else if(ebitda>10){cls="warn";txt="Marginal – Scale Sensitive";}

  verdictBox.className="verdict "+cls;
  verdictBox.innerText=txt;
}

/* ================= ELEMENTS ================= */
const chemSearch = document.getElementById("chemSearch");
const chemResults = document.getElementById("chemResults");
const scale = document.getElementById("scale");
const evalBtn = document.getElementById("evalBtn");

const moleculeImg = document.getElementById("moleculeImg");
const resultGrid = document.getElementById("resultGrid");

const capex = document.getElementById("capex");
const opexEl = document.getElementById("opex");
const ebitdaEl = document.getElementById("ebitda");
const ideal = document.getElementById("ideal");
const verdictBox = document.getElementById("verdictBox");
</script>

</body>
</html>
