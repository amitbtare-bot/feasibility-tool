<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chemical Feasibility Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:Segoe UI;
  background:#1f2a44;
  color:#fff;
  margin:0;
  transition:background 1.2s ease;
}

header{text-align:center;padding:20px}

main{
  max-width:1200px;
  margin:auto;
  background:#f4f6f8;
  color:#222;
  padding:30px;
  border-radius:14px;
  position:relative;
  z-index:2;
}

label{font-weight:600;margin-top:10px;display:block}
input,button{width:100%;padding:8px;margin-top:6px}
button{background:#263238;color:#fff;border:none;margin-top:12px;cursor:pointer}
button:disabled{opacity:.5;cursor:not-allowed}

#moleculeStage{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index:0;
}

#molecule{
  width:300px;
  opacity:0.15;
  animation:spin 40s linear infinite;
}

@keyframes spin{
  from{transform:rotateY(0deg) rotateX(15deg);}
  to{transform:rotateY(360deg) rotateX(15deg);}
}

#chemResults{
  background:#fff;color:#000;border-radius:6px;
  max-height:200px;overflow:auto;display:none;
}

#chemResults div{
  padding:6px;cursor:pointer;border-bottom:1px solid #eee
}
#chemResults div:hover{background:#e0e0e0}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;margin-top:20px
}

.card{
  background:#263238;color:#fff;
  padding:15px;border-radius:10px;text-align:center
}

.verdict{padding:15px;border-radius:10px;font-size:18px;margin-top:20px}
.good{background:#2e7d32}
.warn{background:#ef6c00}
.bad{background:#c62828}

canvas{margin-top:25px}
</style>
</head>

<body>

<!-- MOLECULE VISUAL -->
<div id="moleculeStage">
  <div id="molecule"></div>
</div>

<header>
<h1>Chemical Feasibility Tool</h1>
<p>Scale-first • Engineering-driven</p>
</header>

<main>

<label>Search Chemical</label>
<input id="chemSearch" placeholder="ethyl, acetone, resin…" oninput="filterChemicals()">
<div id="chemResults"></div>
<input type="hidden" id="chemical">

<label>Capacity (TPA)</label>
<input id="scale" type="number" placeholder="Enter plant capacity" oninput="checkReady()">

<button id="evalBtn" onclick="evaluate()" disabled>Evaluate Feasibility</button>

<div class="grid" id="grid" style="display:none">
  <div class="card"><h3>CAPEX</h3><div id="capex"></div></div>
  <div class="card"><h3>OPEX</h3><div id="opex"></div></div>
  <div class="card"><h3>EBITDA</h3><div id="ebitda"></div></div>
  <div class="card"><h3>Ideal Scale</h3><div id="ideal"></div></div>
</div>

<div id="verdictBox" class="verdict">Select chemical & capacity</div>

<canvas id="chart"></canvas>

</main>

<script>
let CHEM_DB=[],DB_READY=false,chart;

const THEMES={
  Esterification:"#1f2a44",
  Hydrogenation:"#1b5e20",
  Oxidation:"#263238",
  Resin_Polymerization:"#4a148c",
  default:"#1f2a44"
};

/* SIMPLE INLINE SVG MOLECULES */
const MOLECULES={
  "Ethyl Acetate":`
  <svg viewBox="0 0 200 120">
    <circle cx="40" cy="60" r="8"/><circle cx="80" cy="60" r="8"/>
    <circle cx="120" cy="60" r="8"/><circle cx="160" cy="60" r="8"/>
    <line x1="48" y1="60" x2="72" y2="60" stroke="black"/>
    <line x1="88" y1="60" x2="112" y2="60" stroke="black"/>
    <line x1="128" y1="60" x2="152" y2="60" stroke="black"/>
  </svg>`,
  "Acetone":`
  <svg viewBox="0 0 200 120">
    <circle cx="50" cy="60" r="8"/>
    <circle cx="100" cy="60" r="10"/>
    <circle cx="150" cy="60" r="8"/>
    <line x1="58" y1="60" x2="90" y2="60" stroke="black"/>
    <line x1="110" y1="60" x2="142" y2="60" stroke="black"/>
  </svg>`,
  "Isopropyl Alcohol":`
  <svg viewBox="0 0 200 120">
    <circle cx="70" cy="60" r="8"/>
    <circle cx="110" cy="40" r="8"/>
    <circle cx="110" cy="80" r="8"/>
    <line x1="78" y1="60" x2="102" y2="44" stroke="black"/>
    <line x1="78" y1="60" x2="102" y2="76" stroke="black"/>
  </svg>`
};

/* LOAD CSV */
fetch("chemicals.csv")
.then(r=>r.text())
.then(t=>{
  const rows=t.trim().split("\n");
  const h=rows[0].split(",");
  CHEM_DB=rows.slice(1).map(r=>{
    const v=r.split(",");
    let o={};h.forEach((k,i)=>o[k.trim()]=(v[i]||"").trim());
    return o;
  });
  DB_READY=true;
});

/* SEARCH */
function filterChemicals(){
  const q=chemSearch.value.toLowerCase();
  chemResults.innerHTML="";
  if(q.length<2)return chemResults.style.display="none";
  CHEM_DB.filter(c=>c.chemical_name.toLowerCase().includes(q))
  .forEach(c=>{
    const d=document.createElement("div");
    d.innerText=c.chemical_name;
    d.onclick=()=>selectChemical(c);
    chemResults.appendChild(d);
  });
  chemResults.style.display="block";
}

function selectChemical(c){
  chemSearch.value=c.chemical_name;
  chemical.value=c.chemical_id;
  chemResults.style.display="none";

  document.body.style.background=THEMES[c.process_family]||THEMES.default;
  molecule.innerHTML=MOLECULES[c.chemical_name]||"";

  checkReady();
}

function checkReady(){
  evalBtn.disabled=!(DB_READY && chemical.value && scale.value);
}

function evaluate(){
  const c=CHEM_DB.find(x=>x.chemical_id===chemical.value);
  const S=+scale.value;

  grid.style.display="grid";

  const opex=+c.base_opex_rs_per_t;
  const ebitda=((c.selling_price_rs_per_t-opex)/c.selling_price_rs_per_t*100).toFixed(1);

  capex.innerText=`₹${c.base_capex_cr} Cr`;
  opexEl.innerText=`₹${opex}`;
  ebitdaEl.innerText=`${ebitda} %`;
  ideal.innerText=`${c.ideal_scale_min_tpa}-${c.ideal_scale_max_tpa}`;

  verdictBox.className="verdict "+(ebitda>15?"good":ebitda>10?"warn":"bad");
  verdictBox.innerText=ebitda>15?"Viable":ebitda>10?"Marginal":"Not Recommended";
}

/* ELEMENTS */
const chemSearch=document.getElementById("chemSearch");
const chemResults=document.getElementById("chemResults");
const chemical=document.getElementById("chemical");
const scale=document.getElementById("scale");
const evalBtn=document.getElementById("evalBtn");

const capex=document.getElementById("capex");
const opexEl=document.getElementById("opex");
const ebitdaEl=document.getElementById("ebitda");
const ideal=document.getElementById("ideal");
const verdictBox=document.getElementById("verdictBox");
const molecule=document.getElementById("molecule");
const grid=document.getElementById("grid");
</script>

</body>
</html>
