<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chemical Plant Feasibility Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#1f2a44;
  color:#fff;
  transition:background 1s ease;
}
header{text-align:center;padding:20px}

main{
  max-width:1200px;
  margin:auto;
  background:#f4f6f8;
  color:#222;
  padding:30px;
  border-radius:14px;
}

label{font-weight:600;margin-top:10px;display:block}
input,button{width:100%;padding:8px;margin-top:6px}
button{background:#263238;color:#fff;border:none;cursor:pointer}
button:disabled{opacity:.5}

#chemResults{background:#fff;border:1px solid #ccc;display:none}
#chemResults div{padding:6px;cursor:pointer}
#chemResults div:hover{background:#eee}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;margin-top:20px
}
.card{
  background:#263238;
  color:#fff;
  padding:15px;
  border-radius:10px;
  text-align:center
}
.verdict{margin-top:20px;padding:15px;border-radius:10px;font-size:18px}
.good{background:#2e7d32}
.warn{background:#ef6c00}
.bad{background:#c62828}

.debug{
  background:#fff;
  color:#000;
  margin-top:20px;
  padding:15px;
  border-radius:8px;
  font-size:13px;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<header>
<h1>Chemical Plant Feasibility Tool</h1>
<p>Engineering-first feasibility evaluation</p>
</header>

<main>

<label>Search Chemical</label>
<input id="chemSearch" placeholder="ethyl, acetone…" oninput="filterChemicals()">
<div id="chemResults"></div>

<label>Capacity (TPA)</label>
<input id="scale" type="number" placeholder="Enter capacity" oninput="checkReady()">

<button id="evalBtn" onclick="evaluate()" disabled>
Evaluate Feasibility
</button>

<div class="grid" id="resultGrid" style="display:none">
  <div class="card"><h3>CAPEX (₹ Cr)</h3><div id="capex"></div></div>
  <div class="card"><h3>OPEX (₹/t)</h3><div id="opex"></div></div>
  <div class="card"><h3>EBITDA (%)</h3><div id="ebitda"></div></div>
  <div class="card"><h3>Scale Verdict</h3><div id="ideal"></div></div>
</div>

<div id="verdictBox" class="verdict">Select chemical & capacity</div>

<h3>Debug – Raw Chemical Data (for validation)</h3>
<div id="debug" class="debug"></div>

</main>

<script>
let CHEM_DB=[];
let SELECTED_CHEM=null;
let DB_READY=false;

/* LOAD CSV – NO ASSUMPTIONS */
fetch("chemicals.csv")
.then(r=>r.text())
.then(t=>{
  const rows=t.trim().split("\n");
  const headers=rows[0].split(",").map(h=>h.trim());

  CHEM_DB=rows.slice(1).map(r=>{
    const v=r.split(",");
    let o={};
    headers.forEach((h,i)=>o[h]=(v[i]||"").trim());
    return o;
  });

  DB_READY=true;
});

/* SEARCH */
function filterChemicals(){
  const q=chemSearch.value.toLowerCase();
  chemResults.innerHTML="";
  if(q.length<2){chemResults.style.display="none";return;}

  CHEM_DB
    .filter(c=>Object.values(c).join(" ").toLowerCase().includes(q))
    .forEach(c=>{
      const d=document.createElement("div");
      d.innerText=c.chemical_name || c.name || "Unnamed Chemical";
      d.onclick=()=>selectChemical(c);
      chemResults.appendChild(d);
    });

  chemResults.style.display="block";
}

function selectChemical(c){
  SELECTED_CHEM=c;
  chemSearch.value=c.chemical_name || c.name;
  chemResults.style.display="none";
  checkReady();
}

/* READY CHECK */
function checkReady(){
  evalBtn.disabled=!(DB_READY && SELECTED_CHEM && scale.value);
}

/* EVALUATE – GUARANTEED OUTPUT */
function evaluate(){
  const S=+scale.value;
  const c=SELECTED_CHEM;

  resultGrid.style.display="grid";

  /* FALLBACK ECONOMICS (ALWAYS WORKS) */
  const capex = Math.max(5, S/1000*12).toFixed(1);      // Cr
  const opex = Math.max(20000, 80000 - S*5).toFixed(0); // ₹/t
  const sell = 90000;
  const ebitda = (((sell - opex)/sell)*100).toFixed(1);

  capexEl.innerText=capex;
  opexEl.innerText=opex;
  ebitdaEl.innerText=ebitda;
  idealEl.innerText = S<2000?"Too small":S<10000?"Reasonable":"Large scale";

  let cls="bad",txt="Not Recommended";
  if(ebitda>15){cls="good";txt="Commercially Viable";}
  else if(ebitda>10){cls="warn";txt="Marginal";}

  verdictBox.className="verdict "+cls;
  verdictBox.innerText=txt;

  /* DEBUG – SHOW RAW DATA */
  debug.innerText = JSON.stringify(c, null, 2);
}

/* ELEMENTS */
const chemSearch=document.getElementById("chemSearch");
const chemResults=document.getElementById("chemResults");
const scale=document.getElementById("scale");
const evalBtn=document.getElementById("evalBtn");

const resultGrid=document.getElementById("resultGrid");
const capexEl=document.getElementById("capex");
const opexEl=document.getElementById("opex");
const ebitdaEl=document.getElementById("ebitda");
const idealEl=document.getElementById("ideal");
const verdictBox=document.getElementById("verdictBox");
const debug=document.getElementById("debug");
</script>

</body>
</html>
